# 文件系统
## 分区与文件系统
对分区进行格式化是为了在分区上建立文件系统。一个分区通常只能格式化为一个文件系统，但是磁盘阵列等技术可以将一个分区格式化为多个文件系统。

## 组成
最主要的几个组成部分如下：
- inode:一个文件占用一个inode,记录文件的属性，同时记录此文件的内容所在的block编号。
- block:记录文件的内容，文件太大时，会占用多个block

除此之外还包括：
- superblock:记录文件系统的整体信息，包括inode和block的总量、使用量、剩余量，以及文件系统的格式与相关信息等；
- block bitmap:记录block是否被使用的位图。

## 文件读取
对于Ext2文件系统，当要读取一个文件的内容时，先在inode中查找文件内容所在的所有block,然后把所有block的内容读出来。

而对于FAT文件系统，它没有inode，每个block中存储着下一个block的编号。

## 磁盘碎片
指一个文件内容所在的block过于分散，导致磁盘磁头移动距离过大，从而降低磁盘读写性能。

## block
在Ext2文件系统中所支持的block大小有1k,2k及4k三种，不同的大小限制了单个文件和文件系统的最大大小。
|大小|1KB|2KB|4KB|
|--|--|--|
|最大单一文件|16GB|256GB|2TB|
|最大文件系统|2TB|8TB|16TB|
一个block只能被一个文件所使用，未使用的部分直接浪费了。因此如果需要存储大量的小文件，那么最好选用比较小的block。

## inode
inode 具体包含如下信息：
- 权限（read/write/execute);
- 拥有者与群组（owner/group);
- 容量；
- 建立或状态改变的时间（ctime,change time);
- 最近读取时间（atime,access time);
- 最近修改时间（mtime,modify time);
- 定义文件特性的旗标（flag)，如SetUID...;
- 该文件真正的内容指向（pointer);

inode具有以下特点：
- 每个inode大小均固定为128bytes(新的ext4 与 xfs可设定到256bytes);
- 每个文件都仅会占用一个inode;

## 目录
建立一个目录时，会分配一个inode与至少一个block。block记录的内容是目录下所有文件的inode编号以及文件名。

可以看到文件的inode本身不记录文件名，文件名记录在目录中，因此新增文件，删除文件，更改文件名这些操作与目录的写操作有关。

## 日志
如果突然断电，那么文件系统会发生错误，例如断电前只修改了block bitmap,而还没有将数据真正写入block中。

ex3/ex4文件系统引入了日志功能，可以利用日志来修复文件系统。

## 挂载
挂载利用目录作为文件系统的进入点，也就是说，进入目录之后就可以读取文件系统的数据。

## 目录配置
为了使不同Linux发行版本的目录结构保持一致性，FileSystem Hierarchy Standard(FHS)规定了Linux的目录结构。最基础的三个目录如下：
- /（/root，根目录）
- /usr(unix software resource):所有系统默认软件都会安装到这个目录；
- /var（variable):存放系统或程序运行过程中的数据文件了；
