# 管道
Redis 一个请求响应的来回，需要花费一个网络数据包来回的时间。

客户端通过对管道中的指令列表改变读写顺序就可以大幅节省IO时间，管道中指令越多，效果越好。

## 深入理解管道的本质
- 客户端进程调用write将消息写到操作系统内核为套接字准备的发送缓冲send buffer中。
- 客户端操作系统内核将发送缓冲的内容发送到网卡，网卡硬件将数据通过”网际路由“送到服务器的网卡
- 服务器操作系统内核将网卡的数据放到内核为套接字分配的接收缓冲recv buffer中
- 服务器进程调用read从接收缓冲中取出消息进行处理
- 服务器进程调用write将消息写到操作系统内核为套接字准备的发送缓冲send buffer中。
- 服务端操作系统内核将发送缓冲的内容发送到网卡，网卡硬件将数据通过”网际路由“送到客户端的网卡
- 客户端操作系统内核将网卡的数据放到内核为套接字分配的接收缓冲recv buffer中
- 客户端进程调用read从接收缓冲中取出消息进行处理

可见，write操作只负责将数据写到本地操作系统内核的发送缓冲中就返回了，但是如果发送缓冲区满了，那么就需要等待缓冲空出空间来，这个就是写操作IO真正的耗时。

read操作只负责读取本地操作系统内核的接收缓冲中取出消息就结束了，但是如果接收缓冲区是空的，那么就需要等待接收缓冲有消息，这个就是读操作IO真正的耗时。

对于管道来说，连续的write操作根本就没有耗时，之后第一个read操作会等待一个网络的来回开销，然后所有的响应消息就都已经送回到内核的读缓冲了，后续的read操作直接就可以从缓冲中拿到结果，瞬间就返回了。

