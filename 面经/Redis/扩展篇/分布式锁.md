# 分布式锁

## 场景
一个客户端向主节点申请锁，成功后主节点还没有同步到从节点，网络断开了，从节点变成了新的主节点，此时另一个客户端向新的主节点申请锁成功，这样出现了两个客户端同时拥有锁的情况。

## Redlock算法
Redlock采用”大多数机制“，加锁时，它会向过半节点发送set(key,value,nx=True,ex=xxx)指令，只要过半节点set成功，就认为加锁成功。释放锁时，需要向所有节点发送del指令。

Redlock需要考虑出错重试、时钟漂移等很多细节问题，同时因为Redlock需要向多个节点进行读写，意味着相比单实例Redis的性能会下降一些。

