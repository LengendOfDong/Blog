# 概要
在Zookeeper中，节点也成为Znode。由于对于程序员来说，对于zk的操作主要是对znode的操作，因此，有必要对znode进行深入的了解。

zookeeper采用类似文件系统的数据模型，其节点构成了一个具有层级关系的树状结构。

在zk中，节点以绝对路径表示，不存在相对路径，且路径最后不能以/结尾（根节点除外）

## 类型
根据节点的存活时间，可以对节点划分为持久节点和临时节点。节点的类型在创建时就被确定下来，并且不能改变。

持久节点的存活时间不依赖于客户端会话，只有客户端在显式执行删除节点操作时，节点才消失。

临时节点的存活时间依赖于客户端会话，当会话结束，临时节点将会被自动删除。当然也可以手动删除临时节点。利用临时节点的这一特性，我们可以使用临时节点来进行集群管理，包括发现服务的上下线等。

Zookeeper规定，临时节点不能拥有子节点。

### 持久节点
使用命令create可以创建一个持久节点。
```java
create /module1 module1
```
这样，便创建了一个持久节点/module1, 其数据为”module1"

### 临时节点
使用create命令，加上-e参数，可以创建一个临时节点
```java
create -e /module1/app1 app1
```
这样便创建了一个临时节点/module1/app1,其数据为“app1"。关闭会话，然后输入命令：
```java
get /module1/app1
```
可以看到有以下提示，说明临时节点已经被删除：
```java
Node does not exist : /module1/app1
```
### 顺序节点
Zookeeper中还提供了一种顺序节点的节点类型，每次创建顺序节点时，zk都会在路径后面自动添加上10位的数字，例如<path>0000000001,<path>0000000002,这个计数器可以保证在同一个父节点下的子节点是唯一的。在zk内部使用了4个字节的有符号整形来表示这个计数器，也就是说当计数器的大小超过2147483647时，将会发生溢出。
  
顺序节点是节点的一种特性，也就是持久节点和临时节点都可以设置为顺序节点。这样一来，Znode一共就有四种类型：持久节点，临时节点，持久顺序节点以及临时顺序节点。

使用命令create加上-s参数，可以创建顺序节点，例如：
```java
create -s /module1/app app
```
输出：
```java
Created /module1/app0000000001
```
如果在create -s再添加 -e参数，就可以创建一个临时顺序节点。

### 节点数据
Zookeeper虽然提供了在节点数据存储的功能，但它并不将自己定位为一个通用的数据库，也就是说，不应该在节点存储过多的数据。ZK规定节点的数据大小不能超过1M，但实际上我们在znode的数据量应该尽可能地小，因为数据量过大会导致zk性能明显下降。如果确实需要存储大量的数据，一般解决办法是在另外的分布式数据库（例如redis）中保存这部分数据。然后在znode中我们只保留这个数据库中保存位置的索引即可。

### 版本号
对于每个znode，都有三个版本号：
- dataVersion:数据版本号，每次对节点进行set操作，dataVersion的值都会增加1，即使是设置相同的数据
- cversion:子节点的版本号，当znode的子节点有变化时，cversion的值就会增加1.
- aclVersion:ACL的版本号

### 事务id
对于zk来说，每次的变化都会产生一个唯一的事务id，zxid(Zookeeper Transaction ID）,通过zxid,可以确定更新操作的先后顺序，例如，如果zxid小于zxid2,说明zxid1操作先于zxid2发生。




