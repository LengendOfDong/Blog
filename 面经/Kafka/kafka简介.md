# 消息和批次
消息由字节数组组成的，对于kafka来说，它并没有什么特殊的含义或者意义，消息可以有一个可选的元数据，也就是键。当消息以一种可控的方式写入不同的分区时，会用到键。最简单的例子就是为键生成一个一致性散列值，然后使用散列值对主题分区进行取模，为消息选取分区。这样可以保证具有相同键的消息总是被写到相同的分区上。

为了提高效率，消息被分批次写入Kafka。批次就是一组消息，需要在时间延迟和吞吐量之间进行权衡。如果累积的消息越多，一个批次的消息也就越多，需要更多的时间进行处理，同时吞吐量也会下降，但是会降低网络开销。如果每一个消息都单独穿行于网络，会导致大量的网络开销。

# 主题和分区
kafka的消息通过主题进行分类。主题可以被分为若干个分区，一个分区就是一个提交日志。消息以追加的方式写入分区，然后以先入先出的顺序进行读取。

由于一个主题包含几个分区，因此无法在整个主题范围内保证消息的顺序，但是可以保证消息在单个分区内的顺序。

# 生产者与消费者
Kafka的客户端就是Kafka系统的用户，它们被分为两种基本类型，生产者和消费者。

生产者创建消息，在其他发布与订阅系统中，生产者可能被称为发布者或者写入者。一般情况下，消息会被发布到一个特定的主题上。生产者在默认情况下把消息均衡地分布到主题的所有分区上。在某些情况下，生产者会把消息直接写到指定的分区上，通过为消息的键生成一个散列值，再对分区数进行取模，再发布到特定的分区上，这样对于具有相同键的消息就可以发布到同一个分区上。生产者也可以使用自定义的分区器，根据不同的业务规则将消息映射到分区。

消费者读取消息，在其他发布与订阅系统中，消费者可能被称为订阅者或者读者。偏移量是另一种元数据，它是一个不断递增的整数值，在创建消息时，Kafka会把它添加到消息里。

消费者把每个分区最后读取的消息偏移量保存在zookeeper或者kafka上，这样如果消费者关闭或者重启，它的读取状态不会消失。

消费者是消费者群组的一部分，也就是说，会有一个或者多个消费者共同读取一个主题，群组保证每个分区只能有一个消费者使用。消费者数量必然是小于等于主题中的分区数的。消费者与分区之间的映射通常被称为消费者对分区的**所有权关系**。

