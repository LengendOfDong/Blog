# 可靠性保证
了解系统的保证机制对于构建可靠的应用程序来说至关重要。

kafka可以在哪些方面做出保证：
- kafka可以保证分区消息的顺序。如果使用同一个生产者往同一个分区写入消息，而且消息B在消息A之后写入，那么Kafka可以保证消息B的偏移量比消息A的偏移量大。，而且消费者会先读取消息A再读取消息B。
- 只有当消息被写入分区的所有同步副本时（但不一定要写入磁盘）,它才被认为是“已提交的”。
- 只要还有一个副本时活跃的，那么已经提交的消息就不会丢失。
- 消费者只能读取已经提交的消息。

## 复制
Kafka的复制机制和分区的多副本架构是Kafka可靠性保证的核心。把消息写入多个副本可以使Kafka在发生崩溃时仍能保证消息的持久性。

Kafka的主题被分为多个分区，分区是基本的数据块。每个分区可以有多个副本，其中一个副本是首领。所有的事件都直接发送给首领副本，或者直接从首领副本读取事件。其他副本只需要与首领保持同步，并及时复制最新的事件。

分区首领是同步副本，而对于跟随者来说，它需要满足以下条件才能被认为是同步的。
- 与Zookeeper之间有一个活跃的会话，也就是说，它在过去的6s内向Zookeeper发送过心跳
- 在过去的10s内从首领那里获取过消息
- 在过去的10s内从首领那里获取过最新的消息，光从首领那里获取消息是不够的，它还必须是几乎零延迟的。

## broker配置
broker有3个配置系数会影响Kafka消息存储的可靠性。

1.复制系数

如果复制系数是N，那么在N-1个broker失效的情况下，仍然能够从主题读取数据或向主题写入数据。更高的复制系数会带来更高的可用性、可靠性和更少的故障。另一方面，复制系数N需要至少N个broker，而且会有N个数据副本，也就是说它们会占用N倍的磁盘空间。
