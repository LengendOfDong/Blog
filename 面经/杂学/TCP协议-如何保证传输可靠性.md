# 确保传输可靠性的方式
TCP协议传输的特点主要就是面向字节流、传输可靠、面向连接。

TCP协议保证传输可靠性的方式主要有：
- 校验和
- 序列号
- 确认应答
- 超时重传
- 连接管理
- 流量控制
- 拥塞控制

## 校验和
计算方式：在数据传输的过程中，将发送的数据段都当做一个16位的整数，将这些整数加起来，并且前面的进位不能丢弃，补在后面，最后取反，得到校验和。

![TCP校验和](https://github.com/LengendOfDong/Blog/blob/master/img/TCP%E6%A0%A1%E9%AA%8C%E5%92%8C.png)

发送方：在发送数据之前计算校验和，并进行校验和的填充

接收方：收到数据后，对数据以同样的方式进行计算，切除校验和，与发送方的进行比对。

注意：如果接收方比对校验和与发送方不一致，那么数据一定传输有误。但是如果接收方比对校验和与发送方一致，**数据不一定传输成功** 。

## 确认应答与序列号
序列号：TCP传输时将每个字节的数据都进行了编号，这就是序列号。

确认应答：TCP传输的过程中，每次接收方接收到数据后，都会对传输方进行确认应答。也就是发送ACK报文。这个ACK报文当中带有对应的确认序列号，告诉发送方，接收到了那些数据，下一次的数据从哪里发。

![确认应答](https://github.com/LengendOfDong/Blog/blob/master/img/TCP%E5%8F%AF%E9%9D%A0%E6%80%A7%E4%B9%8B%E7%A1%AE%E8%AE%A4%E5%BA%94%E7%AD%94.png)

序列号的作用不仅仅是应答的作用，有了序列号能够将接收到的数据根据序列号排序，并且去掉重复序列号的数据。这也是TCP传输可靠性的保证之一。

## 超时重传
在进行TCP传输时，由于确认应答与序列号机制，也就是说发送方发送一部分数据后，都会等待接收方发送的ACK报文，并解析ACK报文，判断数据是否传输成功，如果发送方发送完数据后，迟迟没有等到接收方的ACK报文，这该怎么办呢？而没有收到ACK报文的原因可能是什么呢？

首先，发送方没有接收到响应的ACK报文原因可能有两点：

- 数据在传输过程中由于网络原因等直接全体丢包，接收方根本没有接收到。
- 接收方接收到了响应的数据，但是发送的ACK报文响应却由于网络原因丢包了。

TCP在解决这个问题的时候引入了一个新的机制，叫做超时重传机制。简单理解就是发送方在发送完数据后等待一个时间，时间到达没有接收到ACK报文，那么对刚才发送的数据进行重新发送。如果是刚才第一个原因，接收方收到二次重发的数据后，便进行ACK应答。如果是第二原因，接收方发现接收的数据已存在（判断存在的根据就是序列号，所以上面说序列号还有去除重复数据的作用），那么直接丢弃，仍旧发送ACK应答。

