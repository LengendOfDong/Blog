# 原创：与HTTP协作的Web服务器

# 用单台虚拟主机实现多个域名

HTTP/1.1规范允许一台HTTP服务器搭建多个Web站点。这是因为利用了虚拟主机（Virtual Host,又称虚拟服务器）的功能<br/>
即使物理层面只有一台服务器，但只要使用虚拟主机的功能，则可以假想已具有多台服务器。<br/>
当一台服务器内托管了多个域名，当收到请求时就需要弄清楚究竟要访问哪个域名。<br/>
在相同的IP地址下，由于虚拟主机可以寄存多个不同主机名和域名的网站，因此在发送HTTP请求时，必须在Host首部内完整指定主机名或域名的URI。

# 通信数据转发程序：代理、网关、隧道

HTTP通信时，除客户端和服务器以外，还有一些用于通信数据转发的应用程序，例如代理、网关和隧道。它们可以配合服务器工作。

## 代理：

代理服务器的基本行为就是接受客户端发送的请求后转发给其他服务器。代理不改变请求URI，会直接发送给前方持有资源的目标服务器。<br/>
在HTTP通信过程中，可级联多台代理服务器。请求和响应的转发会经过数台类似锁链一样连接起来的代理服务器。转发时，需要附加Via首部字段以标记出经过的主机信息。<br/>
使用代理服务器的理由有：<br/>
1）利用<mark>缓存技术</mark>减少带宽的流量<br/>
2）组织内部对特定网站的访问控制<br/>
3）以获取访问日志为主要目的<br/>
代理有多种使用方法，按两种基准分类。一种是是否使用缓存，另一种是是否会修改报文。

## 网关

网关的工作机制和代理很相似。而网关能使通信线路上的服务器提供非HTTP协议服务。<br/>
利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。

## 隧道

隧道可按要求建立起一条与其他服务器的通信线路，届时使用SSL等加密手段通信。隧道的目的是确保客户端能与服务器进行<mark>安全</mark>的通信。<br/>
隧道本身不会去解析HTTP请求。也就是说，请求保持请求原样中转给之后的服务器。隧道会在通信双方断开连接时结束。

总结下三者的作用：<br/>
代理的作用：减少带宽占用，访问控制，比如公司内网访问外网，科学上网（代理有风险）<br/>
网关的作用：协议转换，比如Web购物网站上进行信用卡结算，与信用卡结算系统联动<br/>
隧道的作用：远距离安全通信，比如通过外网访问公司内网

# 保存资源的缓存

缓存服务器是代理服务器的一种，并归类在缓存代理类型中。<br/>
缓存服务器的优势在于利用缓存可避免多次从源服务器转发资源。因此客户端可就近从缓存服务器上获取资源，而源服务器也不必多次处理相同的请求。

## 缓存的有效期限

缓存有好处，但是利用不当就会出现缓存是脏数据的情况，这个时候就需要在请求的时候，由缓存服务器向源服务器确认数据是否已更新，若更新了，则需要获取新的数据。

## 客户端的缓存

缓存不仅可以存在于缓存服务器中，也可以存在客户端浏览器中。<br/>
以Internet Explorer程序为例，把客户端缓存称为临时网络文件（Temporary Internet File）<br/>
和缓存服务器相同的一点是，当判定缓存过期后，会向源服务器确认资源的有效性。若判断浏览器缓存失效，浏览器会再次请求新资源。
