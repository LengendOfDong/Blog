# 原创：线程的调度方式

# 线程的调度方式

  在一个进程里，线程的调度有抢占式和非抢占式的模式。

## 抢占式

  在抢占模式下，操作系统负责分配CPU时间给各个进程，一旦当前的进程使用完分配给自己的CPU时间，操作系统将决定下一个占用CPU时间的是哪一个线程。因此操作系统将定期的中断当前正在执行的线程，将CPU分配给在等待队列的下一个线程。所以任何一个线程都不能独占CPU。每个线程占用CPU的时间取决于进程和操作系统。进程分配给每个线程的时间很短，以至于我们感觉所有的线程是同时执行的。实际上，系统运行每个进程的时间有2毫秒，然后调度其他的线程，它同时维持着所有的线程和循环，分配很少量的CPU时间给线程。<br/>
  调度是什么意思？调度意味着处理器存储着将要执行完CPU时间的进程的状态和将来某个时间装载这个进程的状态而恢其运行。<br/>
  抢占式有不足之处，一个线程可以在任何给定的时间中断另外一个线程的执行。假设一个线程正在向一个文件做写入操作，而另外一个线程中断其运行，也向同一个文件做写操作，就会出现写入问题。

## 非抢占式

  在非抢占式调度模式下，每个线程可以需要CPU多少时间就占用CPU多少时间。在这种调度方式下，可能一个执行时间很长的线程使得其他所有需要CPU的线程“饿死”。在处理机空闲，即该进程没有使用CPU时，系统可以允许其他的进程暂时使用CPU。占用CPU 的线程拥有对CPU的控制权，只有它自己主动释放CPU时，其他的线程才可以使用CPU。

## 何时用

  在有些操作系统里面，这两种调度策略都会用到。<br/>
  非抢占的调度策略在线程运行优先级一般时用到，而对于高优先级的线程调度则多采用抢占式的调度策略。如果你不确定系统采用的是哪种调度策略，假设抢占的调度策略不可用是比较安全的。（前面说明了，文件写入影响很大）<br/>
  在设计应用程序的时候，我们认为那些占用CPU时间比较多的线程在一定的间隔是会释放CPU的控制权的，这时候系统会查看那些在等候队列里面的与当前执行的线程同一优先级或者更高的优先级的线程，而让这些线程得以使用CPU。如果系统找到一个这样的线程，就立刻暂停当前执行的线程和激活满足条件的线程。如果没有找到同一优先级或更高级的线程，当前线程还继续占有CPU。当正在执行的线程想释放CPU的控制权给一个低优先级的线程，当前线程就转入睡眠状态而让低优先级的线程占有CPU。
