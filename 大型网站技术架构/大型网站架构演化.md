# 大型网站架构演化

## 大型网站软件系统的特点
- 高并发，大流量：高并发用户，大流量访问
- 高可用：系统7 * 24小时不间断服务
- 海量数据：需要存储、管理海量数据，需要使用大量服务器
- 用户分布广泛，网络情况复杂：为全球用户服务，用户分布范围广，各地网络情况千差万别。
- 安全环境恶劣：互联网站更容易受到黑客攻击。
- 需求快速变更，发布频繁：互联网产品为快速适应市场，需要极高的产品发布频率。
- 渐进式发展：好的互联网产品都是慢慢运营出来的，通过不停地迭代，与网站架构的发展演化过程对应。

## 大型网站架构演化发展历程
- 初始阶段的网站架构

  应用程序，文件，数据库系统都在一台服务器上，应用程序使用PHP开发，服务器操作系统使用Linux,然后部署在Apache上，数据库使用MySQL。
  
  缺点：用户访问数增多导致性能越来越差，同时数据增多导致存储空间不足。

- 应用服务和数据服务分离

  应用服务器、文件、数据库分别在不同的机器上。应用和数据分离后，不同特性的服务器承担着不同的角色。
  
  缺点：数据库压力太大导致访问延迟，进而影响整个网站的性能，用户体验受到影响。
 
- 使用缓存改善网站性能

  网站访问特点遵循二八定律，即80%的业务访问集中在20%的数据上。将这小部分数据缓存在内存中，可以减少数据的访问压力，提高整个网站的数据访问速度，改善数据库的写入性能。
  
  缓存可以分为两种：缓存在应用服务器上的本地缓存和缓存在专门的分布式服务器上的远程缓存。本地缓存访问速度快，但受应用服务器的内存大小限制，远程缓存可以使用集群的方式，内存可以做得很大。
  
  缺点：单一应用服务器能够处理的请求连接有限，在网站访问高峰期，应用服务器成为整个网站的瓶颈。
  
- 使用应用服务器集群改善

  使用集群时网站解决高并发、海量数据问题的常用手段。对网站架构而言，只要能通过增加一台服务器的方式改善负载压力，就可以以同样的方式持续增加服务器不断改善系统性能，从而实现系统的可伸缩性。
  
  缺点：仍有一部分读操作（缓存访问不命中，缓存过期）和全部的写操作需要访问数据库，数据库会成为网站的瓶颈。
  
- 数据库读写分离

  数据库主从热备功能，应用服务器在写数据的时候，访问主数据库，主数据库通过主从复制机制将数据更新同步到从数据库，这样当应用服务器读数据的时候，就可以通过从数据库获得数据。
  
  为了便于应用程序访问读写分离的数据库，通常在应用程序服务器使用专门的数据访问模块，使数据库读写分离对应用透明。
  
  缺点：由于复杂的网络环境，不同地区的用户访问网站时，速度差别也极大。
  
- 使用反向代理和CDN加速网站响应

  CDN和反向代理的基本原理都是缓存，区别在于CDN部署在网络提供商的机房，使用户在请求网络服务时，可以从距离自己最近的网络提供商机房获取数据；而反向代理
则部署在网站的中心机房，当用户请求到达中心机房后，首先访问的服务器是反向代理服务器，如果反向代理服务器中缓存着用户请求的资源，就将其直接返回给用户。

  使用CDN和反向代理的目的都是尽早返回数据给用户，一方面加快用户访问速度，另一方面也减轻后端服务器的负载压力。
  
  缺点：数据库和文件系统随着业务规模的扩大，容量需要扩大
 
- 使用分布式文件系统和分布式数据库系统
  
  分布式数据库时网站数据库拆分的最后手段，只有在单表数据规模非常庞大的时候才使用。网站更常用的数据库拆分手段是业务分库，将不同业务的数据库部署在不同的物理服务器上。
  
  缺点：对于数据的检索支持不够
  
- 使用NoSQL和搜索引擎

  NoSQL和搜索引擎都是源自互联网的技术手段，对可伸缩的分布式特性具有更好的支持。应用服务器则通过一个统一数据访问模块访问各种数据，减轻应用程序管理诸多数据源的麻烦。
  
- 业务拆分

  通过使用分而治之的手段将整个网站业务分成不同的产品线。
  
  具体到技术上，也会根据产品线划分，将一个网站拆分成不同的应用，每个应用独立部署维护。应用之间可以通过一个超链接建立关系，也可以通过消息队列进行数据分发。
  
  缺点：随着业务拆分越来越小，存储系统越来越大，应用系统的整体复杂度呈指数级增加，部署维护越来越困难。
  
- 分布式服务

  由于每一个应用系统都需要执行许多相同的业务操作，比如用户管理、商品管理等，那么可以将这些共用的业务提取出来，独立部署。由这些可复用的业务连接数据库，提供共用业务服务，而应用系统只需要管理用户界面，通过分布式服务调用共用业务服务完成具体业务操作。
  
  大型网站架构解决了海量数据的管理和高并发事务的处理，那么就可以把这些解决方案应用到网站自身以外的业务上去。许多大型网站都开始建设云计算平台，将计算作为一种基础资源出售，中小网站不需要再关心技术架构问题，只需要按需付费，就可以使网站随着业务的增长逐渐获得更大的存储空间和更多的计算资源。
    
## 经验教训
  教训：12306网站在售票过程中出现崩溃的情况
  
  经验：12306的业务架构自身就有很大的问题：在整点进行秒杀式抢票，而是应该换一种方式卖票。12306后来换了一种方式：在售票方式上引入了排队机制，整点售票调整为分时段售票。
  
  在使用淘宝过程中也可以看到，在不同的时段也有秒杀活动，这样不仅促进了商品的售卖，也同时控制住了并发访问的量。
  
 
