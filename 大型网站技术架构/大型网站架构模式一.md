# 大型网站架构模式
## 分层
分层是企业应用系统中最常见的一种架构模式，将系统在横向维度上切分成几个部分，每个部分负责一部分相对比较单一的职责，然后通过上层对下层的依赖和调用组成一个完整的系统。

在大型网站架构中也采用分层结构，将网站软件系统分为应用层、服务层、数据层。
|层级|作用|
|:-:|:-:|
|应用层|负责具体业务和视图展示，如网站首页及搜索输入和结果展示|
|服务层|为应用层提供服务支持，如用户管理服务，购物车服务等|
|数据层|提供数据存储访问服务，如数据库、缓存、文件、搜索引擎等|

分层架构需要合理规划层次边界和接口，在开发过程中，严格遵循分层架构的约束，禁止跨层次的调用及逆向调用。

在网站规模还很小的时候就应该采取分层的架构，这样将来网站做大时才能有更好地应对。

## 分割
如果说分层是将软件在横向方面进行切分，那么分割就是在纵向方面对软件进行切分。

大型网站分割的粒度会很小，比如在应用层，将不同的业务进行分割，例如将购物、论坛、搜索、广告分割成不同的应用，由独立的团队负责，部署在不同的服务器上；在同一个应用内部，还会继续进行分割，比如购物业务，可以进一步分割成机票酒店业务、3C业务，小商品业务等更细小的粒度。

## 分布式
对大型网站，分层和分割的一个主要目的就是为了切分后的模块便于分布式部署，即将不同模块部署在不同的服务器上，通过远程调用协同工作。

分布式带来的几个问题：
- 服务调用通过网络，对性能造成很大影响
- 服务器越多，服务器宕机的概率也就越大，一台服务器宕机会降低网站的可用性
- 数据在分布式环境保持数据一致性非常困难
- 分布式事务难以保证，对网站业务正确性和业务流程有很大影响
- 网站依赖错综复杂，开发管理非常困难

常用的分布式方案：
- 应用和服务分布式

  将分层和分割后的应用和服务模块分布式部署。
  
  好处：
  
  - 改善网站性能和并发性、加快开发和发布速度、减少数据库连接资源消耗
  - 使不同应用复用共同的服务，便于业务功能扩展
  
- 静态资源分布式

  网站资源如JS、CSS、Logo图片等资源独立分布式部署，并采用独立的域名，进行动静分离。
  
  好处：
  
  - 减轻应用服务器的负载压力
  - 使用独立域名加快浏览器并发加载的速度
  - 由负责用户体验的团队进行开发维护有利于网站分工合作，使不同技术工种术业有专攻
  
- 数据和存储分布式

  分布式存储海量数据，为网站而生的各种NoSQL产品几乎都是分布式的。
  
  好处：
   
  - 为应用程序提供充足的存储空间
  
- 计算分布式

  目前网站普遍使用Hadoop及其MapReduce分布式计算框架进行此类批处理计算，其特点是移动计算而不是移动数据，将计算程序分发到数据所在的位置以加速计算和分布式计算。
  
  好处：
  
   - 能够支撑业务的大量计算，包括索引构建，数据分析统计等工作
   
## 集群

  对于用户访问集中的模块，比如网站的首页，还需要将独立部署的服务器集群化，即多台服务器部署相同应用构成一个集群，通过负载均衡设备共同对外提供服务。
  
  因为服务器集群有更多服务器提供相同服务，因此可以提供更好的并发特性，当有更多用户访问时，只需要向集群中增加新的机器即可。
  
  出于提高系统的可用性考虑，在网站应用中，即使是访问量很小的分布式应用和服务，也至少要部署两台服务器构成一个小的集群。
  

