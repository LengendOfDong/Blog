# 大型网站架构模式
## 缓存

- CDN：内容分发网络，部署在距离终端用户最近的网络服务商，用户的网络请求总是先到到他的网络服务商那里，在这里缓存网站的一些静态资源（较少变化的数据），可以就近以最快的速度返回给用户。
- 反向代理：反向代理属于网站前端架构的一部分，部署在网站的前端，当用户请求到达网站的数据中心时，最先访问到的就是反向代理服务器，这里缓存网站的静态资源，无需请求继续转发就可以返回给用户。
- 本地缓存：在应用服务器本地缓存着热点数据，应用程序可以在本机内存中直接访问数据，而无需访问数据库。
- 分布式缓存：将数据缓存在一个专门的分布式缓存集群中，通过网络通信的方式来访问缓存数据

使用缓存的两个前提条件：
- 数据访问热点不均衡，某些数据会被更频繁的访问，这些数据应该放在缓存中
- 数据在某个时间段内不会失效，否则缓存会因为失效而产生脏数据，影响结果的正确性。

缓存不仅可以加快数据访问速度，还可以减轻后端应用和数据库的负载压力。

## 异步
大型网站架构中系统解耦合的手段除了分层，分割以及分布之外，还有一个重要手段就是异步，业务之间的消息传递不是同步调用，而是将一个业务操作分成多个阶段，每个阶段之间通过共享数据的方式异步执行调用。

在单一服务器内部可通过多线程共享内存队列的方式实现异步，处在业务操作前面的线程将输出写入到队列，后面的线程从队列中读取数据进行处理。

分布式消息队列可以看作是内存队列的分布式部署。

异步架构的优点：

- 提高系统可用性

  消费者服务器发生故障，对于生产者服务器没有影响，消费者服务器恢复正常后，可以继续处理消息队列中的数据。
  
- 加快网站响应速度

  处在业务处理前端的生产者服务器在处理完业务请求后，将数据写入消息队列，不需要等待消费者处理就可以返回，响应延迟减少。
  
- 消除并发访问高峰

  使用消息队列将突然增加的访问请求数据放入消息队列中，等待消费者服务器依次处理，就不会对整个网站负载造成太大压力。
  
## 冗余

  访问和负载很小的服务也必须部署至少两台服务器构成一个集群，其目的就是通过冗余实现服务高可用。数据库除了定期备份，存档保存，实现**冷备份**外，为了保证在线业务高可用，还需要对数据库进行主从分离，实时同步实现**热备份**。
  
  某些大型网站会对整个数据中心进行备份，全球范围内部署**灾备数据中心**。
  
## 自动化

  通过减少人为干预，使**发布过程自动化**可以有效减少故障。
  
  发布过程自动化包括以下几个环节：
  
  - 自动化代码管理
  - 自动化测试
  - 自动化安全监测
  - 自动化部署
  
## 安全

  网站在安全架构方面有许多模式：
  
  - 通过密码和手机校验码进行身份认证
  - 登录、交易等操作需要对网络通信进行加密，网站服务器上存储的敏感数据如用户信息等也进行加密处理
  - 为了防止机器人程序滥用网络资源攻击网站，网站使用验证码进行识别
  - 对于常见的攻击网站的XSS攻击、SQL注入，进行编码转换等相应处理。
  - 对于垃圾信息、敏感信息进行过滤
  - 对交易转账等重要操作根据交易模式和交易信息进行风险控制。
  
 ## 新浪微博的架构
  早期：新浪微博发布使用同步推的方式，用户发表微博后系统会立即将这条微博插入到数据库所有粉丝的订阅列表中，这种同步的方式，用户需要等待很久，响应很慢
  
  缺点：当明星用户发布微博时，会引起大量的数据库写操作，超出数据库负载，系统性能急剧下降。
  
  改造：新浪微博改用异步推拉的方式，用户发表微博后，会立即返回，响应迅速。消息队列消费者任务将微博推送给所有当前在线粉丝的订阅列表中，非在线用户登录后再根据关注列表拉取微博订阅列表。
  
  新浪微博使用**多级缓存**策略，热门微博和明星用户的微博缓存在所有微博服务器上，在线用户的微博和近期微博缓存在分布式缓存集群中。
