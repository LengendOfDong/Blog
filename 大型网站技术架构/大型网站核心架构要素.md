# 大型网站核心架构要素
软件架构通常需要关注性能、可用性、伸缩性、扩展性和安全性等5个架构要素。

架构设计过程中需要平衡这5个要素之间的关系，以实现需求和架构目标，也可以通过考察这些架构要素来衡量一个软件架构设计的优劣，判断其是否满足期望。

## 性能
从用户浏览器到数据库，影响用户请求的环节都可以进行优化：
- 浏览器
  
  可以通过浏览器缓存、页面压缩、合理布局页面、减少Cookie传输等手段改善性能
  
- CDN

  将网站静态内容分发至离用户最近的网络服务商机房，使用户通过最短访问路径获取数据。
  
- 反向代理

  可以在网站机房部署反向代理服务器，缓存热点文件，加快请求响应速度，减轻应用程序服务器负载压力
  
- 应用服务器

  可以使用服务器本地缓存和分布式缓存，通过缓存在内存中的热点数据处理用户请求，加快请求处理过程，减轻数据库负载压力。
  
  通过异步操作将用户请求发送至消息队列等待后续任务处理，而当前请求直接返回响应给用户。
  
- 集群

  在高并发请求的情况下，多台应用服务器组成一个集群共同对外服务，提高整体处理能力，提高性能。
  
- 代码
 
  可以通过多线程、改善内存管理等手段优化性能。
  
- 数据库服务器

  索引、缓存、SQL优化等性能优化手段都已经比较成熟。NoSQL数据库通过优化数据模型、存储结构、伸缩特性等手段在性能方面优势也非常明显。
  
## 可用性
网站高可用架构设计的前提是必然会出现服务器宕机，不宕机高可用设计就毫无意义了。高可用设计的目标就是当服务器宕机时，服务或者应用依然可用。

网站高可用的常用手段就是冗余。

对于应用服务器来说，多台应用服务器通过负载均衡设备组成一个集群共同对外提供服务，任何一台服务器宕机，只需把请求切换到其他服务器就可实现应用的高可用。

对于存储服务器来说，由于其上存储着数据，需要对数据进行实时备份，当服务器宕机时需要将数据访问转移到可用的服务器上，并进行数据恢复以保证继续有服务器宕机的时候，数据依然可用。

在软件开发过程中，预发布验证、自动化测试、自动化发布、灰度发布等手段都可以减少故障引入线上环境的可能，避免故障范围扩大。

## 伸缩性
伸缩性是指通过不断向集群中增加服务器的手段来缓解不断上升的用户并发访问压力和不断增长的数据存储需求。

衡量架构伸缩性的主要标准：
- 是否可以用多台服务器构建集群
- 是否容易向集群中添加新的服务器
- 是否可以提供和原来的服务器无差别的服务
- 集群中可容纳的总的服务器数量是否有限制

对于应用服务器集群，只要服务器上不保存数据，所有服务器都是对等的，通过使用合适的负载均衡设备就可以向集群中不断加入服务器。

对于缓存服务器集群，加入新的服务器可能会导致缓存路由失效，进而导致集群中大部分缓存数据都无法访问。需要改进缓存路由算法保证缓存数据的可访问性。

关系数据库虽然支持数据复制，主从热备等机制，但是很难做到大规模集群的可伸缩性，因此关系数据库的集群伸缩性方案必须在数据库之外实现，通过路由分区等手段将
部署有多个数据库的服务器组成一个集群。

对于大部分NoSQL数据库产品，由于其先天就是为海量数据而生，因此其对伸缩性支持都很好。

## 扩展性
网站可扩展架构的主要手段是事件驱动架构和分布式服务。

事件驱动架构在网站通常利用消息队列实现，将用户请求和其他业务事件构造成消息发布到消息队列，消息的处理者作为消费者从消息队列中获取消息进行处理。通过这种方式将消息产生和消息处理分离开来，可以透明地增加新的消息生产者任务或者新的消息消费者任务。

分布式服务则是将业务和可复用服务分离开来，通过分布式服务框架调用。
